{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{%  block title %}AniCritic{% endblock %}</title>
    <link href="{% static 'css/my_style.css' %}" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>
<body>
    <header class="py-3" style="background-color: gold;">
    <div class="container">
      <div class="d-flex align-items-center justify-content-between">
          <h1 class="title" style="text-align: end;">AniCritic</h1>

        <!-- Search (right side) -->
        <form class="d-flex" role="search" action="{% url 'search' %}" method="get" style="max-width: 360px;">
          <input name="q"
                 class="form-control me-2"
                 type="search"
                 placeholder="Search anime & crew"
                 value="{{ request.GET.q|default:'' }}">
          <button class="btn btn-dark" type="submit">Search</button>
        </form>
      </div>
    </div>
  </header>
    <div class="navigation-bar">
        <ul class="navigation-list">
            <li class="navigation-item">
                <a class="navigation-link" href="{% url 'index' %}">Home</a>
            </li>
            <li class="navigation-item">
                <a class="navigation-link" href="{% url 'anime_list' %}">Movies & Animes</a>
            </li>
            {% if user.is_authenticated %}
                <li class="navigation-item">
                    <a class="navigation-link" href="{% url 'diary' %}">Diary</a>
                </li>
            {% endif %}
            {% if user.is_superuser %}
                <li class="dropdown">Admin Functions
                    <ul class="dropdown-menu">
                        <li class="navigation-item">
                            <a class="navigation-link" href="{% url 'anime_create' %}">Add Anime</a>
                        </li>
                        <li class="navigation-item">
                            <a class="navigation-link" href="{% url 'anime_selection_list' %}">Add Crew</a>
                        </li>
                    </ul>
                </li>
            {% endif %}
            <li class="dropdown">Account
                <ul class="dropdown-menu">
                   {% if user.is_authenticated %}

                       <!--Profile Link will go here -->
                       <li>Profile</li>

                       <!--Logout button-->
                       <li>
                           <form action="{% url 'logout' %}" method="post">
                               {% csrf_token %}
                               <button type="submit">Log out</button>
                           </form>
                       </li>
                   {% else %}
                       <!--Login/Register-->
                       <li class="navigation-item">
                           <a class="navigation-link" href="{% url 'login' %}">Login/Register</a>
                       </li>
                   {% endif %}
                </ul>
            </li>
        </ul>
    </div>
    <div class="container">
        <br/>
        {% block content %}

        {% endblock %}
    </div>
</body>
<script>
    function detectAndSetUserTimezone() {
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        // Use the Fetch API to send the timezone to a Django endpoint
        fetch('/set-timezone/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // Important: get the CSRF token from a cookie or template tag
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ 'timezone': timezone })
        }).then(response => {
            if (response.ok) {
                console.log("User timezone set to:", timezone);
            }
        });
    }
    detectAndSetUserTimezone();
</script>
</html>